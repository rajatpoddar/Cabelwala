<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invoice - {{ invoice.invoice_number }}</title>
    <style>
        @page { margin: 0; size: A4 portrait; }
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #222; margin: 0; padding: 30px 40px; font-size: 12px; line-height: 1.4; }
        
        /* Typography & Colors */
        .primary-color { color: #1e3a8a; }
        .bg-primary { background-color: #1e3a8a; color: white; }
        .bg-light { background-color: #f8fafc; }
        
        /* Structural Tables */
        table { width: 100%; border-collapse: collapse; }
        td { vertical-align: top; }

        /* Header Area */
        .header-table { margin-bottom: 20px; border-bottom: 3px solid #1e3a8a; padding-bottom: 15px; }
        .logo-img { max-width: 90px; max-height: 90px; border-radius: 5px; }
        .company-name { margin: 0; font-size: 22px; text-transform: uppercase; font-weight: bold; color: #1e3a8a; }
        .company-info { margin: 2px 0; color: #444; font-size: 11px; }
        .invoice-title { margin: 0; font-size: 26px; text-transform: uppercase; font-weight: bold; color: #1e3a8a; text-align: right; }
        .invoice-meta { margin: 2px 0; font-size: 12px; text-align: right; }

        /* Info Boxes (Bill To & Bill For) */
        .info-table { margin-bottom: 20px; border-spacing: 15px 0; border-collapse: separate; margin-left: -15px; width: calc(100% + 30px); }
        .info-box { background-color: #f8fafc; padding: 12px 15px; border-radius: 6px; border-left: 3px solid #1e3a8a; }
        .box-heading { margin: 0 0 5px 0; font-size: 13px; color: #1e3a8a; border-bottom: 1px solid #e2e8f0; padding-bottom: 3px; text-transform: uppercase; }
        .box-text { margin: 3px 0; font-size: 12px; }

        /* Items Table */
        .items-table { margin-bottom: 20px; border: 1px solid #cbd5e1; }
        .items-table th { background-color: #1e3a8a; color: white; padding: 8px 10px; text-align: left; font-size: 11px; text-transform: uppercase; border: 1px solid #1e3a8a; }
        .items-table td { padding: 8px 10px; border: 1px solid #cbd5e1; font-size: 12px; }
        .items-table tr:nth-child(even) { background-color: #f8fafc; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }

        /* Totals Area */
        .totals-wrapper { width: 100%; margin-bottom: 25px; }
        .totals-table { width: 35%; float: right; }
        .totals-table td { padding: 6px 10px; text-align: right; font-size: 12px; }
        .grand-total-row { background-color: #1e3a8a; color: white; font-weight: bold; font-size: 15px; }

        /* Payment & QR */
        .payment-table { clear: both; page-break-inside: avoid; border-spacing: 15px 0; border-collapse: separate; margin-left: -15px; width: calc(100% + 30px); }
        .payment-box { padding: 12px 15px; border: 1px solid #cbd5e1; border-radius: 6px; background: #fff; }
        .qr-layout { width: 100%; border-collapse: collapse; }
        .qr-layout td { vertical-align: middle; border: none; padding: 0; }
        .qr-img { width: 85px; height: 85px; border: 1px solid #cbd5e1; padding: 3px; }

        /* Footer */
        .signature-area { margin-top: 30px; text-align: right; page-break-inside: avoid; }
        .signature-line { display: inline-block; width: 150px; border-top: 1px solid #1e3a8a; padding-top: 5px; font-weight: bold; font-size: 11px; color: #1e3a8a; text-align: center; }
        .footer-text { margin-top: 25px; text-align: center; font-size: 10px; color: #64748b; padding-top: 10px; border-top: 1px solid #e2e8f0; text-transform: uppercase; font-weight: bold; }
    </style>
</head>
<body>

    <table class="header-table">
        <tr>
            {% if logo_base64 %}
            <td style="width: 15%;">
                <img src="data:image/png;base64,{{ logo_base64 }}" class="logo-img">
            </td>
            <td style="width: 45%; padding-left: 10px;">
            {% else %}
            <td style="width: 60%;">
            {% endif %}
                <p class="company-name">{{ business.company_name }}</p>
                <p class="company-info">{{ business.address }}</p>
                <p class="company-info">Mobile: {{ business.phone }} | Email: {{ business.email }}</p>
                {% if business.gst_no %}<p class="company-info">GST No: {{ business.gst_no }}</p>{% endif %}
            </td>
            <td style="width: 40%;">
                <p class="invoice-title">Invoice</p>
                <p class="invoice-meta">Invoice No: <strong>{{ invoice.invoice_number }}</strong></p>
                <p class="invoice-meta">Date: <strong>{{ invoice.created_at.strftime('%d/%m/%Y') }}</strong></p>
            </td>
        </tr>
    </table>

    <table class="info-table">
        <tr>
            <td class="info-box" style="width: 50%;">
                <p class="box-heading">Bill To</p>
                <p class="box-text"><strong>{{ client.name }}</strong></p>
                <p class="box-text">Mobile: {{ client.mobile }}</p>
                <p class="box-text">{{ client.address }}, {{ client.area }}</p>
            </td>
            <td class="info-box" style="width: 50%;">
                <p class="box-heading">Bill For</p>
                <p class="box-text" style="font-weight: bold; color: #2563eb; font-size: 14px;">{{ invoice.bill_for }}</p>
                <p class="box-text">Status: <strong style="color: {% if invoice.status == 'Paid' %}#059669{% else %}#dc2626{% endif %};">{{ invoice.status }}</strong></p>
            </td>
        </tr>
    </table>

    <table class="items-table">
        <thead>
            <tr>
                <th width="5%" class="text-center">#</th>
                <th width="55%">Item Description</th>
                <th width="10%" class="text-center">Qty</th>
                <th width="15%" class="text-right">Price (₹)</th>
                <th width="15%" class="text-right">Total (₹)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items %}
            <tr>
                <td class="text-center">{{ loop.index }}</td>
                <td style="font-weight: 500;">{{ item.description }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right">{{ "%.2f"|format(item.price) }}</td>
                <td class="text-right">{{ "%.2f"|format(item.total) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="totals-wrapper">
        <table class="totals-table">
            <tr>
                <td>Subtotal:</td>
                <td>₹{{ "%.2f"|format(invoice.subtotal) }}</td>
            </tr>
            <tr>
                <td>Tax:</td>
                <td>₹{{ "%.2f"|format(invoice.tax) }}</td>
            </tr>
            <tr class="grand-total-row">
                <td>Grand Total:</td>
                <td>₹{{ "%.2f"|format(invoice.total) }}</td>
            </tr>
        </table>
        <div style="clear: both;"></div>
    </div>

    <table class="payment-table">
        <tr>
            <td class="payment-box" style="width: 50%;">
                <p class="box-heading" style="border:none; text-decoration: underline;">Bank Details</p>
                <p class="box-text">Bank: <strong>{{ business.bank_name or '-' }}</strong></p>
                <p class="box-text">Account: <strong>{{ business.account_number or '-' }}</strong></p>
                <p class="box-text">IFSC: <strong>{{ business.ifsc_code or '-' }}</strong></p>
                <p class="box-text">Name: <strong>{{ business.account_name or '-' }}</strong></p>
            </td>
            <td class="payment-box" style="width: 50%;">
                <p class="box-heading" style="border:none; text-decoration: underline;">UPI Payment</p>
                <table class="qr-layout">
                    <tr>
                        {% if qr_code_data %}
                        <td style="width: 100px;">
                            <img src="data:image/png;base64,{{ qr_code_data }}" class="qr-img">
                        </td>
                        {% endif %}
                        <td>
                            <p class="box-text" style="font-weight: 600;">ID: {{ business.upi_id or '-' }}</p>
                            <p class="box-text" style="font-weight: 600;">Payee: {{ business.payee_name or '-' }}</p>
                            <p class="box-text" style="font-style: italic; color: #64748b; font-size: 10px;">Scan with any UPI App</p>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

    <div class="signature-area">
        <div class="signature-line">Authorized Signature</div>
    </div>

    <div class="footer-text">
        {{ business.terms or '' }}
    </div>

</body>
</html>